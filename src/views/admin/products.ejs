<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏ ‚Äî HandWood</title>
    <link rel="stylesheet" href="/styles/main.css">
    <link rel="stylesheet" href="/styles/admin.css">
    <style>
      /* –°–ü–ï–¶–ò–§–ò–ß–ù–´–ï –°–¢–ò–õ–ò –î–õ–Ø –°–¢–†–ê–ù–ò–¶–´ –¢–û–í–ê–†–û–í */

      /* –§–ò–õ–¨–¢–† –ü–û –ö–ê–¢–ï–ì–û–†–ò–Ø–ú */
      .category-filter {
        display: flex;
        gap: 0.8rem;
        margin-bottom: 1.5rem;
        flex-wrap: wrap;
        align-items: center;
      }

      .filter-label {
        font-weight: 600;
        color: #4A2C1F;
        margin-right: 0.5rem;
      }

      .filter-btn {
        padding: 0.6rem 1.2rem;
        border: 2px solid #e0e0e0;
        background: white;
        border-radius: 20px;
        cursor: pointer;
        transition: all 0.3s;
        color: #666;
        font-weight: 500;
        font-size: 0.9rem;
      }

      .filter-btn:hover {
        border-color: #8B5E3C;
        color: #8B5E3C;
      }

      .filter-btn.active {
        background: #8B5E3C;
        color: white;
        border-color: #8B5E3C;
      }

      .products-list {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 1.5rem;
      }

      .product-card {
        border: 1px solid #e0e0e0;
        border-radius: 10px;
        padding: 1.2rem;
        display: flex;
        flex-direction: column;
        transition: all 0.3s;
        background: #fafaf8;
        position: relative;
        overflow: hidden;
      }

      .product-card:hover {
        box-shadow: 0 6px 20px rgba(0,0,0,0.12);
        border-color: #8B5E3C;
        background: white;
        transform: translateY(-2px);
      }

      .product-image {
        width: 100%;
        height: 100px;
        border-radius: 8px;
        object-fit: cover;
        background: #e8e3db;
        margin-bottom: 1rem;
      }

      .product-image.placeholder {
        display: flex;
        align-items: center;
        justify-content: center;
        color: #999;
        font-size: 3rem;
      }

      .product-info {
        display: flex;
        flex-direction: column;
        gap: 0.6rem;
        flex: 1;
      }

      .product-name {
        font-size: 1rem;
        font-weight: 600;
        color: #4A2C1F;
        line-height: 1.3;
      }

      .product-desc {
        color: #666;
        font-size: 0.85rem;
        line-height: 1.4;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }

      .product-meta {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        margin-top: 0.8rem;
        font-size: 0.85rem;
        padding-top: 0.8rem;
        border-top: 1px solid #f0f0f0;
      }

      .product-price {
        font-weight: 700;
        color: #8B5E3C;
        font-size: 1.1rem;
      }

      .product-category {
        color: #666;
        display: inline-block;
        padding: 0.3rem 0.6rem;
        background: #f0e8df;
        border-radius: 4px;
        width: fit-content;
      }

      .product-actions {
        display: flex;
        flex-direction: column;
        gap: 0.6rem;
        margin-top: auto;
        padding-top: 1rem;
      }

      .btn-action {
        padding: 0.6rem 0.8rem;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s;
        text-align: center;
        font-size: 0.75rem;
        text-decoration: none;
        display: inline-block;
        flex: 1;
        white-space: nowrap;
      }

      .btn-edit {
        background: #2196F3;
        color: white;
      }

      .btn-edit:hover {
        background: #0b7dda;
      }

      .btn-delete {
        background: #f44336;
        color: white;
      }

      .btn-delete:hover {
        background: #da190b;
      }

      .empty-state {
        text-align: center;
        padding: 3rem 1rem;
        color: #999;
      }

      .empty-state-icon {
        font-size: 3rem;
        margin-bottom: 1rem;
      }

      /* –ö–û–õ–õ–ê–ü–° –§–û–†–ú–´ –î–û–ë–ê–í–õ–ï–ù–ò–Ø –¢–û–í–ê–†–ê */
      .form-section {
        background: white;
        border: 1px solid #e0e0e0;
        border-radius: 10px;
        margin-bottom: 1.5rem;
        overflow: hidden;
        transition: all 0.3s ease;
      }

      .form-section.collapsed {
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      }

      .form-section-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 1.2rem 1.5rem;
        background: #f5f5f5;
        cursor: pointer;
        user-select: none;
        border-bottom: 1px solid #e0e0e0;
        transition: all 0.3s ease;
      }

      .form-section.collapsed .form-section-header {
        border-bottom: none;
      }

      .form-section-header:hover {
        background: #efefef;
      }

      .form-section-header-title {
        display: flex;
        align-items: center;
        gap: 1rem;
        font-weight: 600;
        color: #4A2C1F;
        font-size: 1.1rem;
      }

      .form-toggle-btn {
        font-size: 1.5rem;
        transition: transform 0.3s ease;
      }

      .form-section.collapsed .form-toggle-btn {
        transform: rotate(-90deg);
      }

      .form-section-content {
        padding: 1.5rem;
        display: none;
        animation: slideDown 0.3s ease;
      }

      .form-section-content.visible {
        display: block;
      }

      @keyframes slideDown {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .templates-section {
        background: #f9f7f5;
        padding: 1rem;
        border-radius: 8px;
        margin-bottom: 1.5rem;
        border: 1px solid #e8ddd4;
      }

      .templates-title {
        font-weight: 600;
        color: #4A2C1F;
        margin-bottom: 0.8rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .templates-list {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 0.8rem;
      }

      .template-btn {
        padding: 0.8rem 1rem;
        background: white;
        border: 2px solid #8B5E3C;
        color: #8B5E3C;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
        font-size: 0.9rem;
        transition: all 0.3s;
        text-align: center;
      }

      .template-btn:hover {
        background: #8B5E3C;
        color: white;
      }

      .templates-controls {
        display: flex;
        gap: 0.5rem;
        margin-top: 1rem;
      }

      .templates-edit-btn {
        padding: 0.6rem 1rem;
        background: #FFA500;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
        font-size: 0.85rem;
        transition: all 0.3s;
      }

      .templates-edit-btn:hover {
        background: #FF8C00;
      }

      /* –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –î–õ–Ø –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø –®–ê–ë–õ–û–ù–û–í */
      #templatesModal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.5);
        z-index: 3000;
        align-items: center;
        justify-content: center;
        padding: 1rem;
      }

      #templatesModal.show {
        display: flex;
      }

      .templates-modal-content {
        background: white;
        border-radius: 10px;
        padding: 2rem;
        max-width: 800px;
        max-height: 80vh;
        overflow-y: auto;
        width: 100%;
      }

      .templates-modal-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: #4A2C1F;
        margin-bottom: 1.5rem;
      }

      .template-edit-section {
        margin-bottom: 2rem;
        padding-bottom: 1.5rem;
        border-bottom: 1px solid #e0e0e0;
      }

      .template-edit-section:last-child {
        border-bottom: none;
      }

      .template-edit-title {
        font-weight: 600;
        color: #4A2C1F;
        margin-bottom: 0.8rem;
        font-size: 1rem;
      }

      .template-edit-form {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
      }

      .template-edit-form .form-group {
        margin-bottom: 0;
      }

      .template-edit-form .form-group[style*="grid-column"] {
        grid-column: 1 / -1;
      }

      .templates-modal-actions {
        display: flex;
        gap: 1rem;
        margin-top: 2rem;
        justify-content: flex-end;
      }

      /* –ö–ù–û–ü–ö–ê –ö–û–ü–ò–†–û–í–ê–ù–ò–Ø –¢–û–í–ê–†–ê */
      .btn-copy {
        background: #FF9800;
        color: white;
      }

      .btn-copy:hover {
        background: #F57C00;
      }

      /* –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û */
      #editModal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.5);
        z-index: 2000;
        align-items: center;
        justify-content: center;
        padding: 1rem;
      }

      #editModal.show {
        display: flex;
      }

      .existing-images {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
        gap: 0.8rem;
        margin-top: 1rem;
      }

      .image-item {
        position: relative;
        border-radius: 8px;
        overflow: hidden;
      }

      .image-item img {
        width: 100%;
        height: 80px;
        object-fit: cover;
      }

      .image-delete-btn {
        position: absolute;
        top: 4px;
        right: 4px;
        width: 28px;
        height: 28px;
        background: rgba(244, 67, 54, 0.9);
        color: white;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        font-size: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s;
      }

      .image-delete-btn:hover {
        background: #f44336;
      }

      /* –ú–û–ë–ò–õ–¨–ù–ê–Ø –í–ï–†–°–ò–Ø */
      @media (max-width: 768px) {
        .admin-sidebar {
          width: 100%;
          position: fixed;
          left: 0;
          top: 0;
          height: 100vh;
          z-index: 1100;
          transform: translateX(-100%);
        }

        .admin-sidebar.visible {
          transform: translateX(0);
        }

        .admin-sidebar.hidden {
          transform: translateX(-100%);
        }

        .admin-main {
          margin-left: 0;
          padding: 1rem;
        }

        .menu-toggle {
          display: block;
        }

        .products-list {
          grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        }

        .product-actions {
          flex-direction: column;
        }

        .topbar-title {
          font-size: 1.4rem;
        }

        .form-grid {
          grid-template-columns: 1fr;
        }

        .modal-content {
          padding: 1.5rem;
        }
      }

      @media (max-width: 480px) {
        .admin-sidebar {
          width: 90vw;
          max-width: 250px;
          transform: translateX(-100%);
        }

        .admin-sidebar.visible {
          transform: translateX(0);
        }

        .admin-main {
          padding: 0.75rem;
        }

        .topbar-title {
          font-size: 1.2rem;
        }

        .products-list {
          grid-template-columns: 1fr;
        }

        .product-card {
          padding: 1rem;
        }

        .content-section {
          padding: 1.5rem;
        }

        .modal-actions {
          grid-template-columns: 1fr;
        }

        .category-filter {
          flex-direction: column;
          align-items: flex-start;
        }
      }
    </style>
</head>
<body>
    <div class="admin-wrapper">
      <aside class="admin-sidebar" id="adminSidebar">
        <div class="sidebar-logo">
          <h2>üîê HandWood</h2>
        </div>

        <nav class="sidebar-nav">
          <li><a href="/admin">üìä –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</a></li>
          <li><a href="/admin/products" class="active">üì¶ –¢–æ–≤–∞—Ä—ã</a></li>
          <li><a href="/admin/categories">üìÇ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏</a></li>
        </nav>

        <div class="sidebar-footer">
          <a href="/admin/change-password" class="pwd-btn">üîë –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è</a>
          <a href="/admin/logout" class="logout-btn">üö™ –í—ã—Ö–æ–¥</a>
        </div>
      </aside>

      <main class="admin-main">
        <div class="admin-topbar">
          <div class="topbar-left">
            <button class="menu-toggle" id="menuToggle" onclick="toggleMenu()">‚ò∞</button>
            <h1 class="topbar-title">–¢–æ–≤–∞—Ä—ã</h1>
          </div>
        </div>

        <!-- –î–û–ë–ê–í–ò–¢–¨ –¢–û–í–ê–† -->
        <div class="form-section collapsed">
          <div class="form-section-header" onclick="toggleFormSection(this)">
            <div class="form-section-header-title">
              <span class="form-toggle-btn">‚ñº</span>
              <span>‚ûï –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä</span>
            </div>
          </div>
          <div class="form-section-content">
            <!-- –®–ê–ë–õ–û–ù–´ –ó–ê–ü–û–õ–ù–ï–ù–ò–Ø -->
            <div class="templates-section">
              <div class="templates-title">üìã –®–∞–±–ª–æ–Ω—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è</div>
              <div class="templates-list">
                <button type="button" class="template-btn" onclick="applyTemplate('default')">–ü—É—Å—Ç–æ–π —à–∞–±–ª–æ–Ω</button>
                <button type="button" class="template-btn" onclick="applyTemplate('furniture')">ü™ë –ú–µ–±–µ–ª—å</button>
                <button type="button" class="template-btn" onclick="applyTemplate('decor')">üñºÔ∏è –î–µ–∫–æ—Ä</button>
                <button type="button" class="template-btn" onclick="applyTemplate('kit')">üì¶ –ù–∞–±–æ—Ä</button>
              </div>
              <div class="templates-controls">
                <button type="button" class="templates-edit-btn" onclick="openTemplatesModal()">‚öôÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —à–∞–±–ª–æ–Ω—ã</button>
              </div>
            </div>

            <form action="/admin/products" method="POST" enctype="multipart/form-data" class="form-grid">
              <div class="form-group">
                <label for="name">–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ *</label>
                <input type="text" id="name" name="name" required placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ">
              </div>

              <div class="form-group">
                <label for="price">–°—Ç–æ–∏–º–æ—Å—Ç—å *</label>
                <input type="number" id="price" name="price" step="0.01" required placeholder="0.00" min="0">
              </div>

              <div class="form-group">
                <label for="category_id">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                <select id="category_id" name="category_id">
                  <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                  <% categories.forEach(category => { %>
                    <option value="<%= category.id %>"><%= category.name %></option>
                  <% }); %>
                </select>
              </div>

              <div class="form-group" style="grid-column: 1 / -1;">
                <label for="description">–û–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞</label>
                <textarea id="description" name="description" rows="3" placeholder="–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞"></textarea>
              </div>

              <!-- –°–ï–ö–¶–ò–Ø: –†–ê–ó–ú–ï–† -->
              <div class="form-group">
                <label for="size_open">–†–∞–∑–º–µ—Ä –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ</label>
                <input type="text" id="size_open" name="size_open" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 25√ó30 —Å–º">
              </div>

              <div class="form-group">
                <label for="size_closed">–†–∞–∑–º–µ—Ä –≤ –∑–∞–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ</label>
                <input type="text" id="size_closed" name="size_closed" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 15√ó20 —Å–º">
              </div>

              <div class="form-group">
                <label for="weight_net">–ß–∏—Å—Ç—ã–π –≤–µ—Å</label>
                <input type="text" id="weight_net" name="weight_net" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 200 –≥">
              </div>

              <div class="form-group">
                <label for="weight_gross">–í–µ—Å –±—Ä—É—Ç—Ç–æ (—Å —É–ø–∞–∫–æ–≤–∫–æ–π)</label>
                <input type="text" id="weight_gross" name="weight_gross" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 250 –≥">
              </div>

              <div class="form-group">
                <label for="diameter">–î–∏–∞–º–µ—Ç—Ä –¥–µ—Ç–∞–ª–µ–π</label>
                <input type="text" id="diameter" name="diameter" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 5 –º–º">
              </div>

              <!-- –°–ï–ö–¶–ò–Ø: –ß–¢–û –°–û–î–ï–†–ñ–ò–¢ –ù–ê–ë–û–† -->
              <div class="form-group" style="grid-column: 1 / -1;">
                <label for="contents">–ß—Ç–æ —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–∞–±–æ—Ä</label>
                <textarea id="contents" name="contents" rows="3" placeholder="–ü–µ—Ä–µ—á–∏—Å–ª–∏—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –Ω–∞–±–æ—Ä–∞"></textarea>
              </div>

              <!-- –°–ï–ö–¶–ò–Ø: –î–û–°–¢–ê–í–ö–ê –ò –í–û–ó–í–†–ê–¢ (–ø–æ–∫–∞ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–∑–∂–µ) -->
              <div class="form-group" style="grid-column: 1 / -1;">
                <label for="delivery_return">–î–æ—Å—Ç–∞–≤–∫–∞ –∏ –≤–æ–∑–≤—Ä–∞—Ç (—à–∞–±–ª–æ–Ω –±—É–¥–µ—Ç –ø–æ–∑–∂–µ)</label>
                <textarea id="delivery_return" name="delivery_return" rows="3" placeholder="–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ—Å—Ç–∞–≤–∫–µ –∏ –≤–æ–∑–≤—Ä–∞—Ç–µ"></textarea>
              </div>

              <!-- –°–ï–ö–¶–ò–Ø: –ò–ù–°–¢–†–£–ö–¶–ò–ò –ü–û –£–•–û–î–£ -->
              <div class="form-group" style="grid-column: 1 / -1;">
                <label for="care_instructions">–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —É—Ö–æ–¥—É</label>
                <textarea id="care_instructions" name="care_instructions" rows="3" placeholder="–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É—Ö–æ–¥—É –∑–∞ —Ç–æ–≤–∞—Ä–æ–º"></textarea>
              </div>

              <div class="form-group" style="grid-column: 1 / -1;">
                <label for="images">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞</label>
                <input type="file" id="images" name="images" accept="image/*" multiple>
                <p class="form-hint">–í—ã –º–æ–∂–µ—Ç–µ –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ</p>
              </div>

              <button type="submit" class="btn-submit">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</button>
            </form>
          </div>
        </div>

        <!-- –°–ü–ò–°–û–ö –¢–û–í–ê–†–û–í -->
        <div class="content-section">
          <h2 class="section-title">üì¶ –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–æ–≤–∞—Ä—ã (<%= products.length %>)</h2>
          
          <% if (categories.length > 0) { %>
            <div class="category-filter">
              <span class="filter-label">–§–∏–ª—å—Ç—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º:</span>
              <button class="filter-btn active" data-category="all" onclick="filterByCategory('all', this)">
                –í—Å–µ —Ç–æ–≤–∞—Ä—ã
              </button>
              <% categories.forEach(category => { %>
                <button class="filter-btn" data-category="<%= category.id %>" onclick="filterByCategory('<%= category.id %>', this)">
                  <%= category.name %>
                </button>
              <% }); %>
            </div>
          <% } %>
          
          <% if (products.length === 0) { %>
            <div class="empty-state">
              <div class="empty-state-icon">üì¶</div>
              <p>–¢–æ–≤–∞—Ä–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π —Ç–æ–≤–∞—Ä –≤—ã—à–µ.</p>
            </div>
          <% } else { %>
            <div class="products-list">
              <% products.forEach(product => { %>
                <div class="product-card" data-product-id="<%= product.id %>" data-category-id="<%= product.category_id || '' %>">
                  <% if (product.image_path) { %>
                    <img src="<%= product.image_path %>" alt="<%= product.name %>" class="product-image">
                  <% } else { %>
                    <div class="product-image placeholder">üì∑</div>
                  <% } %>
                  
                  <div class="product-info">
                    <div class="product-name"><%= product.name %></div>
                    <% if (product.description) { %>
                      <div class="product-desc"><%= product.description %></div>
                    <% } %>
                    <div class="product-meta">
                      <span class="product-price">üí∞ <%= product.price %> ‚ÇΩ</span>
                      <% if (product.category_name) { %>
                        <span class="product-category">üìÇ <%= product.category_name %></span>
                      <% } %>
                    </div>
                  </div>

                  <div class="product-actions">
                    <button type="button" class="btn-action btn-edit" onclick="editProduct(<%= product.id %>)">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                    <button type="button" class="btn-action btn-copy" onclick="copyProductAsTemplate(<%= product.id %>)">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                    <form action="/admin/products/<%= product.id %>/delete" method="POST" style="margin: 0; flex: 1;" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä?')">
                      <button type="submit" class="btn-action btn-delete" style="width: 100%;">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                    </form>
                  </div>
                </div>
              <% }); %>
            </div>
          <% } %>
        </div>

        <div style="text-align: center; margin-top: 2rem; padding-top: 2rem; border-top: 1px solid #e0e0e0;">
          <a href="/admin" style="color: #8B5E3C; text-decoration: none; font-weight: 600;">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</a>
        </div>
      </main>
    </div>

    <!-- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø –®–ê–ë–õ–û–ù–û–í -->
    <div id="templatesModal">
      <div class="templates-modal-content">
        <h2 class="templates-modal-title">‚öôÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —à–∞–±–ª–æ–Ω—ã –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è</h2>
        
        <div id="templatesEditContainer"></div>

        <div class="templates-modal-actions">
          <button type="button" class="btn-cancel" onclick="closeTemplatesModal()">–û—Ç–º–µ–Ω–∞</button>
          <button type="button" class="btn-submit" onclick="saveTemplates()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
      </div>
    </div>

    <!-- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø -->
    <div id="editModal">
      <div class="modal-content">
        <h2 class="modal-title">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä</h2>
        
        <!-- –®–ê–ë–õ–û–ù–´ –ó–ê–ü–û–õ–ù–ï–ù–ò–Ø –î–õ–Ø –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø -->
        <div class="templates-section" style="margin-bottom: 1.5rem;">
          <div class="templates-title">üìã –ü—Ä–∏–º–µ–Ω–∏—Ç—å —à–∞–±–ª–æ–Ω –∫ –æ–ø–∏—Å–∞–Ω–∏—é –∏ —Ç–µ–∫—Å—Ç—É</div>
          <div class="templates-list">
            <button type="button" class="template-btn" onclick="applyEditTemplate('furniture')">ü™ë –ú–µ–±–µ–ª—å</button>
            <button type="button" class="template-btn" onclick="applyEditTemplate('decor')">üñºÔ∏è –î–µ–∫–æ—Ä</button>
            <button type="button" class="template-btn" onclick="applyEditTemplate('kit')">üì¶ –ù–∞–±–æ—Ä</button>
          </div>
        </div>

        <form id="editForm" action="" method="POST" enctype="multipart/form-data" class="modal-form-grid">
          <!-- –°–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ –ø—Ä–µ–≤—å—é -->
          <input type="hidden" name="existing_image" id="existingImage" value="">
          
          <div class="form-group">
            <label>–ù–∞–∑–≤–∞–Ω–∏–µ</label>
            <input type="text" name="name" id="editName" required>
          </div>

          <div class="form-group">
            <label>–°—Ç–æ–∏–º–æ—Å—Ç—å</label>
            <input type="number" name="price" id="editPrice" step="0.01" required>
          </div>

          <div class="form-group">
            <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
            <select name="category_id" id="editCategory">
              <option value="">–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
              <% categories.forEach(category => { %>
                <option value="<%= category.id %>"><%= category.name %></option>
              <% }); %>
            </select>
          </div>

          <div class="form-group" style="grid-column: 1 / -1;">
            <label>–û–ø–∏—Å–∞–Ω–∏–µ</label>
            <textarea name="description" id="editDescription" rows="3"></textarea>
          </div>

          <!-- –°–ï–ö–¶–ò–Ø: –†–ê–ó–ú–ï–† -->
          <div class="form-group">
            <label>–†–∞–∑–º–µ—Ä –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ</label>
            <input type="text" name="size_open" id="editSizeOpen" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 25√ó30 —Å–º">
          </div>

          <div class="form-group">
            <label>–†–∞–∑–º–µ—Ä –≤ –∑–∞–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ</label>
            <input type="text" name="size_closed" id="editSizeClosed" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 15√ó20 —Å–º">
          </div>

          <div class="form-group">
            <label>–ß–∏—Å—Ç—ã–π –≤–µ—Å</label>
            <input type="text" name="weight_net" id="editWeightNet" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 200 –≥">
          </div>

          <div class="form-group">
            <label>–í–µ—Å –±—Ä—É—Ç—Ç–æ (—Å —É–ø–∞–∫–æ–≤–∫–æ–π)</label>
            <input type="text" name="weight_gross" id="editWeightGross" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 250 –≥">
          </div>

          <div class="form-group">
            <label>–î–∏–∞–º–µ—Ç—Ä –¥–µ—Ç–∞–ª–µ–π</label>
            <input type="text" name="diameter" id="editDiameter" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 5 –º–º">
          </div>

          <!-- –°–ï–ö–¶–ò–Ø: –ß–¢–û –°–û–î–ï–†–ñ–ò–¢ –ù–ê–ë–û–† -->
          <div class="form-group" style="grid-column: 1 / -1;">
            <label>–ß—Ç–æ —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–∞–±–æ—Ä</label>
            <textarea name="contents" id="editContents" rows="3" placeholder="–ü–µ—Ä–µ—á–∏—Å–ª–∏—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –Ω–∞–±–æ—Ä–∞"></textarea>
          </div>

          <!-- –°–ï–ö–¶–ò–Ø: –î–û–°–¢–ê–í–ö–ê –ò –í–û–ó–í–†–ê–¢ -->
          <div class="form-group" style="grid-column: 1 / -1;">
            <label>–î–æ—Å—Ç–∞–≤–∫–∞ –∏ –≤–æ–∑–≤—Ä–∞—Ç</label>
            <textarea name="delivery_return" id="editDeliveryReturn" rows="3" placeholder="–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ—Å—Ç–∞–≤–∫–µ –∏ –≤–æ–∑–≤—Ä–∞—Ç–µ"></textarea>
          </div>

          <!-- –°–ï–ö–¶–ò–Ø: –ò–ù–°–¢–†–£–ö–¶–ò–ò –ü–û –£–•–û–î–£ -->
          <div class="form-group" style="grid-column: 1 / -1;">
            <label>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —É—Ö–æ–¥—É</label>
            <textarea name="care_instructions" id="editCareInstructions" rows="3" placeholder="–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É—Ö–æ–¥—É –∑–∞ —Ç–æ–≤–∞—Ä–æ–º"></textarea>
          </div>

          <div class="form-group" style="grid-column: 1 / -1;">
            <label>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</label>
            <input type="file" name="images" accept="image/*" multiple>
            <p class="form-hint">–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç–æ, –µ—Å–ª–∏ –Ω–µ —Ö–æ—Ç–∏—Ç–µ –º–µ–Ω—è—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</p>
          </div>

          <div id="existingImagesContainer"></div>

          <div class="modal-actions">
            <button type="button" class="btn-cancel" onclick="closeEditModal()">–û—Ç–º–µ–Ω–∞</button>
            <button type="submit" class="btn-submit" style="grid-column: auto; width: auto;">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
          </div>
        </form>
      </div>
    </div>

    <script>
      // –õ–û–ö–ê–õ–¨–ù–û–ï –•–†–ê–ù–ò–õ–ò–©–ï –®–ê–ë–õ–û–ù–û–í
      let customTemplates = {
        default: {
          name: '',
          description: '',
          size_open: '',
          size_closed: '',
          weight_net: '',
          weight_gross: '',
          diameter: '',
          contents: '',
          delivery_return: '',
          care_instructions: ''
        },
        furniture: {
          name: '',
          description: '–ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –º–µ–±–µ–ª—å —Ä—É—á–Ω–æ–π —Ä–∞–±–æ—Ç—ã –∏–∑ –Ω–∞—Ç—É—Ä–∞–ª—å–Ω–æ–≥–æ –¥–µ—Ä–µ–≤–∞',
          size_open: '',
          size_closed: '',
          weight_net: '',
          weight_gross: '',
          diameter: '',
          contents: '',
          delivery_return: '–î–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –†–æ—Å—Å–∏–∏. –í–æ–∑–≤—Ä–∞—Ç –≤ —Ç–µ—á–µ–Ω–∏–µ 14 –¥–Ω–µ–π.',
          care_instructions: '–ü—Ä–æ—Ç–∏—Ä–∞—Ç—å –º—è–≥–∫–æ–π —Å—É—Ö–æ–π —Ç–∫–∞–Ω—å—é. –ò–∑–±–µ–≥–∞—Ç—å –ø—Ä—è–º—ã—Ö —Å–æ–ª–Ω–µ—á–Ω—ã—Ö –ª—É—á–µ–π.'
        },
        decor: {
          name: '',
          description: '–£–Ω–∏–∫–∞–ª—å–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç –¥–µ–∫–æ—Ä–∞, —Å–æ–∑–¥–∞–Ω–Ω—ã–π –≤—Ä—É—á–Ω—É—é',
          size_open: '',
          size_closed: '',
          weight_net: '',
          weight_gross: '',
          diameter: '',
          contents: '',
          delivery_return: '–î–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –†–æ—Å—Å–∏–∏. –í–æ–∑–≤—Ä–∞—Ç –≤ —Ç–µ—á–µ–Ω–∏–µ 14 –¥–Ω–µ–π.',
          care_instructions: '–û—Å—Ç–æ—Ä–æ–∂–Ω–æ–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ. –•—Ä–∞–Ω–∏—Ç—å –≤ –∑–∞—â–∏—â—ë–Ω–Ω–æ–º –æ—Ç –≤–ª–∞–≥–∏ –º–µ—Å—Ç–µ.'
        },
        kit: {
          name: '',
          description: '–ì–æ—Ç–æ–≤—ã–π –Ω–∞–±–æ—Ä –¥–ª—è —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–∞, –≤—Å–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –≤–∫–ª—é—á–µ–Ω—ã',
          size_open: '',
          size_closed: '',
          weight_net: '',
          weight_gross: '',
          diameter: '',
          contents: '–í –Ω–∞–±–æ—Ä –≤—Ö–æ–¥–∏—Ç: ',
          delivery_return: '–î–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –†–æ—Å—Å–∏–∏. –í–æ–∑–≤—Ä–∞—Ç –≤ —Ç–µ—á–µ–Ω–∏–µ 14 –¥–Ω–µ–π.',
          care_instructions: '–ò–∑–¥–µ–ª–∏–µ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–≥–æ —É—Ö–æ–¥–∞.'
        }
      };

      // –ù–ê–ó–í–ê–ù–ò–Ø –®–ê–ë–õ–û–ù–û–í (—Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ)
      let templateNames = {
        furniture: 'ü™ë –ú–µ–±–µ–ª—å',
        decor: 'üñºÔ∏è –î–µ–∫–æ—Ä',
        kit: 'üì¶ –ù–∞–±–æ—Ä'
      };

      // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã –∏–∑ localStorage
      function loadTemplatesFromStorage() {
        const saved = localStorage.getItem('productTemplates');
        const savedNames = localStorage.getItem('templateNames');
        if (saved) {
          try {
            customTemplates = JSON.parse(saved);
          } catch (e) {
            console.log('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —à–∞–±–ª–æ–Ω–æ–≤, –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ');
          }
        }
        if (savedNames) {
          try {
            templateNames = JSON.parse(savedNames);
          } catch (e) {
            console.log('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞–∑–≤–∞–Ω–∏–π —à–∞–±–ª–æ–Ω–æ–≤');
          }
        }
      }

      // –°–æ—Ö—Ä–∞–Ω—è–µ–º —à–∞–±–ª–æ–Ω—ã –≤ localStorage
      function saveTemplatesToStorage() {
        localStorage.setItem('productTemplates', JSON.stringify(customTemplates));
        localStorage.setItem('templateNames', JSON.stringify(templateNames));
      }

      // –ó–∞–≥—Ä—É–∂–∞–µ–º —à–∞–±–ª–æ–Ω—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
      loadTemplatesFromStorage();
      updateTemplateButtons();

      // –û–¢–ö–†–´–¢–¨ –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø –®–ê–ë–õ–û–ù–û–í
      function openTemplatesModal() {
        const container = document.getElementById('templatesEditContainer');
        container.innerHTML = '';

        // –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–ï –°–£–©–ï–°–¢–í–£–Æ–©–ò–• –®–ê–ë–õ–û–ù–û–í
        const existingTemplatesDiv = document.createElement('div');
        existingTemplatesDiv.innerHTML = '<h3 style="color: #4A2C1F; margin-bottom: 1rem; margin-top: 0;">–í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã</h3>';
        container.appendChild(existingTemplatesDiv);

        for (const [key, template] of Object.entries(customTemplates)) {
          if (key === 'default') continue;
          
          const section = document.createElement('div');
          section.className = 'template-edit-section';
          
          const nameInput = document.createElement('input');
          nameInput.type = 'text';
          nameInput.id = `templateName_${key}`;
          nameInput.value = templateNames[key] || key;
          nameInput.style.cssText = 'width: 100%; padding: 0.6rem; margin-bottom: 1rem; border: 2px solid #e0e0e0; border-radius: 6px; font-weight: 600; font-size: 1rem;';
          
          section.innerHTML = `
            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
              <div style="flex: 1;"></div>
              <button type="button" class="btn-delete" onclick="deleteTemplate('${key}')" style="padding: 0.5rem 1rem; font-size: 0.8rem;">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å —à–∞–±–ª–æ–Ω</button>
            </div>
            <div class="template-edit-form">
              <div class="form-group">
                <label>–û–ø–∏—Å–∞–Ω–∏–µ</label>
                <textarea data-template="${key}" data-field="description" rows="2" class="template-field">${template.description}</textarea>
              </div>

              <div class="form-group">
                <label>–ß—Ç–æ —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–∞–±–æ—Ä</label>
                <textarea data-template="${key}" data-field="contents" rows="2" class="template-field">${template.contents}</textarea>
              </div>

              <div class="form-group" style="grid-column: 1 / -1;">
                <label>–î–æ—Å—Ç–∞–≤–∫–∞ –∏ –≤–æ–∑–≤—Ä–∞—Ç</label>
                <textarea data-template="${key}" data-field="delivery_return" rows="2" class="template-field">${template.delivery_return}</textarea>
              </div>

              <div class="form-group" style="grid-column: 1 / -1;">
                <label>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —É—Ö–æ–¥—É</label>
                <textarea data-template="${key}" data-field="care_instructions" rows="2" class="template-field">${template.care_instructions}</textarea>
              </div>
            </div>
          `;
          
          // –í—Å—Ç–∞–≤–ª—è–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞ –Ω–∞–∑–≤–∞–Ω–∏—è –≤ –Ω–∞—á–∞–ª–æ
          const nameWrapper = document.createElement('div');
          nameWrapper.className = 'template-edit-title';
          nameWrapper.textContent = '–ù–∞–∑–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞:';
          section.insertBefore(nameInput, section.firstChild);
          section.insertBefore(nameWrapper, section.firstChild);
          
          container.appendChild(section);
        }

        // –î–û–ë–ê–í–õ–ï–ù–ò–ï –ù–û–í–û–ì–û –®–ê–ë–õ–û–ù–ê
        const newTemplateDiv = document.createElement('div');
        newTemplateDiv.style.cssText = 'margin-top: 2rem; padding: 1.5rem; background: #f0f8ff; border: 2px dashed #8B5E3C; border-radius: 8px;';
        newTemplateDiv.innerHTML = `
          <h3 style="color: #4A2C1F; margin-top: 0; margin-bottom: 1rem;">‚ûï –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —à–∞–±–ª–æ–Ω</h3>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
            <input type="text" id="newTemplateName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä: –¢–∫–∞–Ω–∏, –£–∫—Ä–∞—à–µ–Ω–∏—è)" style="padding: 0.8rem; border: 2px solid #e0e0e0; border-radius: 6px;">
            <button type="button" onclick="addNewTemplate()" class="btn-submit" style="padding: 0.8rem;">–°–æ–∑–¥–∞—Ç—å —à–∞–±–ª–æ–Ω</button>
          </div>
        `;
        container.appendChild(newTemplateDiv);

        document.getElementById('templatesModal').classList.add('show');
      }

      // –ó–ê–ö–†–´–¢–¨ –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø –®–ê–ë–õ–û–ù–û–í
      function closeTemplatesModal() {
        document.getElementById('templatesModal').classList.remove('show');
      }

      // –°–û–•–†–ê–ù–ò–¢–¨ –ò–ó–ú–ï–ù–Å–ù–ù–´–ï –®–ê–ë–õ–û–ù–´
      function saveTemplates() {
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ —à–∞–±–ª–æ–Ω–æ–≤
        document.querySelectorAll('.template-field').forEach(field => {
          const template = field.getAttribute('data-template');
          const fieldName = field.getAttribute('data-field');
          customTemplates[template][fieldName] = field.value;
        });

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞–∑–≤–∞–Ω–∏—è —à–∞–±–ª–æ–Ω–æ–≤
        document.querySelectorAll('input[id^="templateName_"]').forEach(input => {
          const key = input.id.replace('templateName_', '');
          const newName = input.value.trim();
          if (newName) {
            templateNames[key] = newName;
          }
        });

        saveTemplatesToStorage();
        closeTemplatesModal();
        updateTemplateButtons();
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        alert('‚úì –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —à–∞–±–ª–æ–Ω–æ–≤ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
      }

      // –î–û–ë–ê–í–ò–¢–¨ –ù–û–í–´–ô –®–ê–ë–õ–û–ù
      function addNewTemplate() {
        const nameInput = document.getElementById('newTemplateName');
        const name = nameInput.value.trim();
        
        if (!name) {
          alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞');
          return;
        }
        
        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID
        const id = 'template_' + Date.now();
        
        // –°–æ–∑–¥–∞—ë–º –Ω–æ–≤—ã–π —à–∞–±–ª–æ–Ω
        customTemplates[id] = {
          name: '',
          description: '',
          size_open: '',
          size_closed: '',
          weight_net: '',
          weight_gross: '',
          diameter: '',
          contents: '',
          delivery_return: '',
          care_instructions: ''
        };
        
        templateNames[id] = name;
        
        saveTemplatesToStorage();
        nameInput.value = '';
        openTemplatesModal();
        
        alert(`‚úì –ù–æ–≤—ã–π —à–∞–±–ª–æ–Ω "${name}" —Å–æ–∑–¥–∞–Ω`);
      }

      // –£–î–ê–õ–ò–¢–¨ –®–ê–ë–õ–û–ù
      function deleteTemplate(key) {
        if (confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —à–∞–±–ª–æ–Ω "${templateNames[key]}"?`)) {
          delete customTemplates[key];
          delete templateNames[key];
          
          saveTemplatesToStorage();
          openTemplatesModal();
          updateTemplateButtons();
          
          alert('‚úì –®–∞–±–ª–æ–Ω —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª—ë–Ω');
        }
      }

      // –û–ë–ù–û–í–ò–¢–¨ –ö–ù–û–ü–ö–ò –®–ê–ë–õ–û–ù–û–í –ù–ê –°–¢–†–ê–ù–ò–¶–ï
      function updateTemplateButtons() {
        // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –≤ —Ñ–æ—Ä–º–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞
        const addFormTemplates = document.querySelector('.form-section .templates-list');
        if (addFormTemplates) {
          addFormTemplates.innerHTML = '';
          for (const [key, name] of Object.entries(templateNames)) {
            const btn = document.createElement('button');
            btn.type = 'button';
            btn.className = 'template-btn';
            btn.onclick = () => applyTemplate(key);
            btn.textContent = name;
            addFormTemplates.appendChild(btn);
          }
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –≤ —Ñ–æ—Ä–º–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞
        const editFormTemplates = document.querySelector('#editModal .templates-list');
        if (editFormTemplates) {
          editFormTemplates.innerHTML = '';
          for (const [key, name] of Object.entries(templateNames)) {
            const btn = document.createElement('button');
            btn.type = 'button';
            btn.className = 'template-btn';
            btn.onclick = () => applyEditTemplate(key);
            btn.textContent = name;
            editFormTemplates.appendChild(btn);
          }
        }
      }

      // –ü–†–ò–ú–ï–ù–ò–¢–¨ –®–ê–ë–õ–û–ù –ö –§–û–†–ú–ï
      function applyTemplate(templateName) {
        const template = customTemplates[templateName] || customTemplates.default;
        
        document.getElementById('name').value = template.name;
        document.getElementById('description').value = template.description;
        document.getElementById('size_open').value = template.size_open;
        document.getElementById('size_closed').value = template.size_closed;
        document.getElementById('weight_net').value = template.weight_net;
        document.getElementById('weight_gross').value = template.weight_gross;
        document.getElementById('diameter').value = template.diameter;
        document.getElementById('contents').value = template.contents;
        document.getElementById('delivery_return').value = template.delivery_return;
        document.getElementById('care_instructions').value = template.care_instructions;

        // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º —Ñ–æ—Ä–º—É –≤ –≤–∏–¥–∏–º—É—é –æ–±–ª–∞—Å—Ç—å
        const form = document.querySelector('.form-section');
        form.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }

      // –ü–†–ò–ú–ï–ù–ò–¢–¨ –®–ê–ë–õ–û–ù –ö –§–û–†–ú–ï –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø
      function applyEditTemplate(templateName) {
        const template = customTemplates[templateName] || customTemplates.default;
        
        // "–£–º–Ω–∞—è" –ª–æ–≥–∏–∫–∞: –ø—Ä–∏–º–µ–Ω—è–µ–º –ø–æ–ª—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–Ω–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –≤ —à–∞–±–ª–æ–Ω–µ
        // –ï—Å–ª–∏ –ø–æ–ª–µ –≤ —à–∞–±–ª–æ–Ω–µ –ø—É—Å—Ç–æ–µ - –Ω–µ —Ç—Ä–æ–≥–∞–µ–º —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ —Ç–æ–≤–∞—Ä–µ
        if (template.description && template.description.trim()) {
          document.getElementById('editDescription').value = template.description;
        }
        if (template.contents && template.contents.trim()) {
          document.getElementById('editContents').value = template.contents;
        }
        if (template.delivery_return && template.delivery_return.trim()) {
          document.getElementById('editDeliveryReturn').value = template.delivery_return;
        }
        if (template.care_instructions && template.care_instructions.trim()) {
          document.getElementById('editCareInstructions').value = template.care_instructions;
        }
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Ç–æ–º, –∫–∞–∫–æ–π —à–∞–±–ª–æ–Ω –±—ã–ª –ø—Ä–∏–º–µ–Ω—ë–Ω
        const templateName_display = templateNames[templateName] || '–®–∞–±–ª–æ–Ω';
        alert(`‚úì –®–∞–±–ª–æ–Ω "${templateName_display}" –ø—Ä–∏–º–µ–Ω—ë–Ω\n\n–ó–∞–ø–æ–ª–Ω–µ–Ω—ã —Ç–æ–ª—å–∫–æ –Ω–µ–ø—É—Å—Ç—ã–µ –ø–æ–ª—è –∏–∑ —à–∞–±–ª–æ–Ω–∞, –æ—Å—Ç–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã`);
      }

      // –ö–û–ü–ò–†–û–í–ê–¢–¨ –î–ê–ù–ù–´–ï –ò–ó –¢–û–í–ê–†–ê –í –§–û–†–ú–£ –î–û–ë–ê–í–õ–ï–ù–ò–Ø
      function copyProductAsTemplate(productId) {
        fetch('/admin/products/' + productId)
          .then(response => response.json())
          .then(product => {
            // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ñ–æ—Ä–º—É –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ —Ç–æ–≤–∞—Ä–∞
            document.getElementById('name').value = '';
            document.getElementById('price').value = '';
            document.getElementById('category_id').value = product.category_id || '';
            document.getElementById('description').value = product.description || '';
            document.getElementById('size_open').value = product.size_open || '';
            document.getElementById('size_closed').value = product.size_closed || '';
            document.getElementById('weight_net').value = product.weight_net || '';
            document.getElementById('weight_gross').value = product.weight_gross || '';
            document.getElementById('diameter').value = product.diameter || '';
            document.getElementById('contents').value = product.contents || '';
            document.getElementById('delivery_return').value = product.delivery_return || '';
            document.getElementById('care_instructions').value = product.care_instructions || '';

            // –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º —Ñ–æ—Ä–º—É
            const formSection = document.querySelector('.form-section');
            if (formSection.classList.contains('collapsed')) {
              formSection.classList.remove('collapsed');
              const content = formSection.querySelector('.form-section-content');
              content.classList.add('visible');
            }

            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º —Ñ–æ—Ä–º—É –≤ –≤–∏–¥–∏–º—É—é –æ–±–ª–∞—Å—Ç—å
            formSection.scrollIntoView({ behavior: 'smooth', block: 'start' });

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            alert(`‚úì –î–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä–∞ "${product.name}" —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –≤ —Ñ–æ—Ä–º—É.\n–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –ø–æ–ª—è –∏ –¥–æ–±–∞–≤—å—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç—å.`);
          })
          .catch(error => {
            console.error('–û—à–∏–±–∫–∞:', error);
            alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–∞');
          });
      }

      // –£–ü–†–ê–í–õ–ï–ù–ò–ï –ö–û–õ–õ–ê–ü–°–û–ú –§–û–†–ú–´ –î–û–ë–ê–í–õ–ï–ù–ò–Ø
      function toggleFormSection(header) {
        const section = header.parentElement;
        const content = section.querySelector('.form-section-content');
        
        section.classList.toggle('collapsed');
        
        if (section.classList.contains('collapsed')) {
          content.classList.remove('visible');
        } else {
          content.classList.add('visible');
        }
      }

      function toggleMenu() {
        const sidebar = document.getElementById('adminSidebar');
        sidebar.classList.toggle('visible');
        sidebar.classList.toggle('hidden');
      }

      // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
      function filterByCategory(categoryId, button) {
        // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
        document.querySelectorAll('.filter-btn').forEach(btn => {
          btn.classList.remove('active');
        });
        button.classList.add('active');

        // –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–≤–∞—Ä—ã
        const products = document.querySelectorAll('.product-card');
        let visibleCount = 0;

        products.forEach(card => {
          const cardCategory = card.getAttribute('data-category-id');
          
          if (categoryId === 'all') {
            card.style.display = '';
            visibleCount++;
          } else {
            if (cardCategory === categoryId) {
              card.style.display = '';
              visibleCount++;
            } else {
              card.style.display = 'none';
            }
          }
        });

        // –ï—Å–ª–∏ –Ω–µ—Ç –≤–∏–¥–∏–º—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        if (visibleCount === 0 && categoryId !== 'all') {
          const empty = document.querySelector('.empty-state');
          if (!empty) {
            const productsList = document.querySelector('.products-list');
            if (productsList) {
              const emptyMsg = document.createElement('div');
              emptyMsg.className = 'empty-state';
              emptyMsg.style.cssText = 'display: block !important;';
              emptyMsg.innerHTML = `
                <div class="empty-state-icon">üì¶</div>
                <p>–í —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–µ—Ç.</p>
              `;
              productsList.parentElement.insertBefore(emptyMsg, productsList);
            }
          }
        }
      }

      if (window.innerWidth <= 768) {
        document.querySelectorAll('.sidebar-nav a').forEach(link => {
          link.addEventListener('click', () => {
            document.getElementById('adminSidebar').classList.remove('visible');
          });
        });
      }

      document.addEventListener('click', (e) => {
        const sidebar = document.getElementById('adminSidebar');
        const toggle = document.getElementById('menuToggle');
        
        if (window.innerWidth <= 768) {
          if (!sidebar.contains(e.target) && !toggle.contains(e.target)) {
            sidebar.classList.remove('visible');
          }
        }
      });

      function editProduct(id) {
        fetch('/admin/products/' + id)
          .then(response => response.json())
          .then(product => {
            document.getElementById('editName').value = product.name;
            document.getElementById('editDescription').value = product.description || '';
            document.getElementById('editPrice').value = product.price;
            document.getElementById('editCategory').value = product.category_id || '';
            document.getElementById('existingImage').value = product.image_path || '';
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—è —Ä–∞–∑–º–µ—Ä–∞
            document.getElementById('editSizeOpen').value = product.size_open || '';
            document.getElementById('editSizeClosed').value = product.size_closed || '';
            document.getElementById('editWeightNet').value = product.weight_net || '';
            document.getElementById('editWeightGross').value = product.weight_gross || '';
            document.getElementById('editDiameter').value = product.diameter || '';
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª–µ "–ß—Ç–æ —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–∞–±–æ—Ä"
            document.getElementById('editContents').value = product.contents || '';
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—è "–î–æ—Å—Ç–∞–≤–∫–∞ –∏ –≤–æ–∑–≤—Ä–∞—Ç" –∏ "–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —É—Ö–æ–¥—É"
            document.getElementById('editDeliveryReturn').value = product.delivery_return || '';
            document.getElementById('editCareInstructions').value = product.care_instructions || '';
            
            const imagesContainer = document.getElementById('existingImagesContainer');
            imagesContainer.innerHTML = '';
            
            if (product.images && product.images.length > 0) {
              const title = document.createElement('div');
              title.style.cssText = 'font-weight: 600; margin-bottom: 0.8rem; margin-top: 1rem;';
              title.textContent = '–ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:';
              imagesContainer.appendChild(title);
              
              const imagesGrid = document.createElement('div');
              imagesGrid.className = 'existing-images';
              
              product.images.forEach(img => {
                const imgWrapper = document.createElement('div');
                imgWrapper.className = 'image-item';
                imgWrapper.innerHTML = `
                  <img src="${img.image_path}" alt="—Ç–æ–≤–∞—Ä">
                  <button type="button" class="image-delete-btn" onclick="deleteProductImage(${product.id}, ${img.id}, this)">√ó</button>
                `;
                imagesGrid.appendChild(imgWrapper);
              });
              
              imagesContainer.appendChild(imagesGrid);
            }
            
            document.getElementById('editForm').action = '/admin/products/' + id + '/update';
            document.getElementById('editModal').classList.add('show');
          });
      }
      
      function deleteProductImage(productId, imageId, btn) {
        if (confirm('–£–¥–∞–ª–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ?')) {
          fetch(`/admin/products/${productId}/images/${imageId}/delete`, { method: 'POST' })
            .then(response => response.json())
            .then(data => {
              if (data.success) {
                // –£–¥–∞–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                btn.closest('.image-item').remove();
                
                // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–æ–≤–∞—Ä–µ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–µ–≤—å—é
                fetch(`/admin/products/${productId}`)
                  .then(response => response.json())
                  .then(product => {
                    // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–≤—å—é –≤ —Ç–∞–±–ª–∏—Ü–µ —Ç–æ–≤–∞—Ä–æ–≤ –µ—Å–ª–∏ –æ–Ω–∞ –≤–∏–¥–∏–º–∞
                    const productRow = document.querySelector(`[data-product-id="${productId}"]`);
                    if (productRow && product.image_path) {
                      const previewImg = productRow.querySelector('.product-image');
                      if (previewImg) {
                        previewImg.src = product.image_path;
                      }
                    }
                  })
                  .catch(error => console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–µ–≤—å—é:', error));
              }
            })
            .catch(error => console.error('–û—à–∏–±–∫–∞:', error));
        }
      }

      function closeEditModal() {
        document.getElementById('editModal').classList.remove('show');
      }

      document.getElementById('editModal').addEventListener('click', (e) => {
        if (e.target.id === 'editModal') {
          closeEditModal();
        }
      });

      document.getElementById('templatesModal').addEventListener('click', (e) => {
        if (e.target.id === 'templatesModal') {
          closeTemplatesModal();
        }
      });
    </script>
</body>
</html>