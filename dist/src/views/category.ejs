<%
  var content = `
    <!-- Hero —Å–µ–∫—Ü–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
    <section class="category-hero">
      <div class="container">
        <!-- –•–ª–µ–±–Ω—ã–µ –∫—Ä–æ—à–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏—è -->
        <nav class="breadcrumb" aria-label="–ù–∞–≤–∏–≥–∞—Ü–∏—è">
          <a href="/" class="breadcrumb-link">üè† –ì–ª–∞–≤–Ω–∞—è</a>
          <span class="breadcrumb-separator">/</span>
          <a href="/gallery" class="breadcrumb-link">üìã –ö–∞—Ç–∞–ª–æ–≥</a>
          <span class="breadcrumb-separator">/</span>
          <span class="breadcrumb-current">${category.name}</span>
        </nav>

        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
        <div class="category-header">
          <div class="category-header-content">
            <h1 class="category-title">${category.name}</h1>
            ${category.description ? '<p class="category-subtitle">' + category.description + '</p>' : '<p class="category-subtitle">–ö–æ–ª–ª–µ–∫—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∏–∑–¥–µ–ª–∏–π —Ä—É—á–Ω–æ–π —Ä–∞–±–æ—Ç—ã</p>'}
            <div class="category-stats">
              <div class="stat-item">
                <span class="stat-number">${products.length}</span>
                <span class="stat-label">—Ç–æ–≤–∞—Ä–æ–≤</span>
              </div>
              <div class="stat-item">
                <span class="stat-icon">‚ú®</span>
                <span class="stat-label">–†—É—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞</span>
              </div>
              <div class="stat-item">
                <span class="stat-icon">üéØ</span>
                <span class="stat-label">–í—ã–±–æ—Ä –º–∞—Å—Ç–µ—Ä–∞</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- –û—Å–Ω–æ–≤–Ω–∞—è —Å–µ–∫—Ü–∏—è —Ç–æ–≤–∞—Ä–æ–≤ -->
    <section class="section gallery-section">
      <div class="container">
        <!-- –ö–æ–Ω—Ç—Ä–æ–ª—ã -->
        <div class="gallery-controls-wrapper">
          <div class="gallery-controls">
            <a href="/gallery" class="btn btn-outline">
              <span>‚Üê</span> –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –∫–∞—Ç–∞–ª–æ–≥
            </a>
            <div class="controls-spacer"></div>
            <span class="gallery-count-badge">
              –ü–æ–∫–∞–∑–∞–Ω–æ: <strong>${products.length}</strong>
            </span>
          </div>
        </div>

        <!-- –°–µ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ -->
        <div class="gallery-grid" role="region" aria-label="–¢–æ–≤–∞—Ä—ã –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ${category.name}">` +
          products.map(product => {
            const hasImage = product.image_path;
            const alt = product.name || '–¢–æ–≤–∞—Ä';
            const price = product.price || '';
            const desc = product.description || '';
            const imageUrl = hasImage ? product.image_path : 'https://via.placeholder.com/400x300';
            
            return `<a href="/product/${product.id}" class="gallery-item-link" title="${alt}">
              <div class="gallery-item" role="article">
                <div class="gallery-item-image">
                  <picture>
                    ${hasImage ? 
                      `<source data-srcset="${imageUrl}?w=800&q=80&fm=webp" type="image/webp">` :
                      `<source data-srcset="https://via.placeholder.com/400x300.webp" type="image/webp">`
                    }
                    <img 
                      src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='400 300'%3E%3C/svg%3E"
                      data-src="${imageUrl}?w=800&q=80" 
                      alt="${alt}" 
                      class="lazy-img"
                      loading="lazy"
                      width="400"
                      height="300">
                  </picture>
                  <div class="gallery-item-overlay">
                    <span class="gallery-item-action">–ü–æ–¥—Ä–æ–±–Ω–µ–µ ‚Üí</span>
                  </div>
                </div>
                <div class="gallery-item-content">
                  <h3 class="gallery-item-title">${alt}</h3>
                  ${desc ? '<p class="gallery-item-description">' + desc + '</p>' : ''}
                  <div class="gallery-item-meta">
                    ${price ? '<p class="gallery-item-price">' + price + ' ‚ÇΩ</p>' : ''}
                  </div>
                </div>
              </div>
            </a>`;
          }).join('') +
          (products.length === 0 ? `
            <div class="empty-state">
              <div class="empty-state-icon">üì¶</div>
              <h3>–¢–æ–≤–∞—Ä–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h3>
              <p>–í —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ–∫–∞ –Ω–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–∑–∂–µ.</p>
              <a href="/gallery" class="btn btn-primary" style="margin-top: 1.5rem;">–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –∫–∞—Ç–∞–ª–æ–≥</a>
            </div>
          ` : '') + `
        </div>

        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π –±–ª–æ–∫ -->
        <div class="category-info-block">
          <h3>–û –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</h3>
          <p>
            –í—Å–µ –∏–∑–¥–µ–ª–∏—è –≤ —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏–∑–≥–æ—Ç–∞–≤–ª–∏–≤–∞—é—Ç—Å—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π –∏ —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤ –º–∞—Å—Ç–µ—Ä—Å—Ç–≤–∞. 
            –ö–∞–∂–¥—ã–π –ø—Ä–µ–¥–º–µ—Ç —É–Ω–∏–∫–∞–ª–µ–Ω –∏ —Å–æ–∑–¥–∞–Ω —Å –æ—Å–æ–±–æ–π —Ç—â–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é –∫ –¥–µ—Ç–∞–ª—è–º.
          </p>
          <div class="category-features">
            <div class="feature">
              <span class="feature-icon">üé®</span>
              <span>–£–Ω–∏–∫–∞–ª—å–Ω—ã–π –¥–∏–∑–∞–π–Ω</span>
            </div>
            <div class="feature">
              <span class="feature-icon">‚úÖ</span>
              <span>–ì–∞—Ä–∞–Ω—Ç–∏—è –∫–∞—á–µ—Å—Ç–≤–∞</span>
            </div>
            <div class="feature">
              <span class="feature-icon">üì¶</span>
              <span>–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞</span>
            </div>
            <div class="feature">
              <span class="feature-icon">üí¨</span>
              <span>–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–∞—Å—Ç–µ—Ä–∞</span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <script>
      // Lazy loading –¥–ª—è —Ç–µ–∫—É—â–µ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
      if (window.lazyLoadUtils && window.lazyLoadUtils.updateLazyLoading) {
        document.addEventListener('DOMContentLoaded', function() {
          setTimeout(() => {
            window.lazyLoadUtils.updateLazyLoading();
          }, 100);
        });
      }
    </script>
  `;
          products.map(product => {
            const hasImage = product.image_path;
            const alt = product.name || '–¢–æ–≤–∞—Ä';
            const price = product.price || '';
            const desc = product.description || '';
            const imageUrl = hasImage ? product.image_path : 'https://via.placeholder.com/400x300';
            
            return `<a href="/product/${product.id}" class="gallery-item-link" title="${alt}">
              <div class="gallery-item" role="article">
                <div class="gallery-item-image">
                  <picture>
                    ${hasImage ? 
                      `<source data-srcset="${imageUrl}?w=800&q=80&fm=webp" type="image/webp">` :
                      `<source data-srcset="https://via.placeholder.com/400x300.webp" type="image/webp">`
                    }
                    <img 
                      src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='400 300'%3E%3C/svg%3E"
                      data-src="${imageUrl}?w=800&q=80" 
                      alt="${alt}" 
                      class="lazy-img"
                      loading="lazy"
                      width="400"
                      height="300">
                  </picture>
                  <div class="gallery-item-overlay">
                    <span class="gallery-item-action">–ü–æ–¥—Ä–æ–±–Ω–µ–µ ‚Üí</span>
                  </div>
                </div>
                <div class="gallery-item-content">
                  <h3 class="gallery-item-title">${alt}</h3>
                  ${desc ? '<p class="gallery-item-description">' + desc + '</p>' : ''}
                  <div class="gallery-item-meta">
                    ${price ? '<p class="gallery-item-price" style="color: var(--color-accent-warm); font-weight: 600; margin-bottom: 0.4rem;">' + price + ' ‚ÇΩ</p>' : ''}
                  </div>
                </div>
              </div>
            </a>`;
          }).join('') +
          (products.length === 0 ? `
            <div style="grid-column: 1 / -1; text-align: center; padding: 4rem 1rem;">
              <p style="font-size: 1.1rem; color: var(--color-text-secondary);">
                –í —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ–∫–∞ –Ω–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–∑–∂–µ.
              </p>
            </div>
          ` : '') + `
        </div>
      </div>
    </section>

    <script>
      // Lazy loading –¥–ª—è —Ç–µ–∫—É—â–µ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
      if (window.lazyLoadUtils && window.lazyLoadUtils.updateLazyLoading) {
        document.addEventListener('DOMContentLoaded', function() {
          setTimeout(() => {
            window.lazyLoadUtils.updateLazyLoading();
          }, 100);
        });
      }
    </script>
  `;
%>
<%- include('layouts/main', { title: category.name + ' ‚Äî HandWood', description: '–ö–∞—Ç–µ–≥–æ—Ä–∏—è: ' + category.name + '. –ò–∑–¥–µ–ª–∏—è –∏–∑ –¥–µ—Ä–µ–≤–∞, –º–µ—Ç–∞–ª–ª–∞ –∏ 3D-–ø–µ—á–∞—Ç–∏.', content }) %>
